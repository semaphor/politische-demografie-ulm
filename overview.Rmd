---
title: "Demografisches zur Ulmer Gemeinderatswahl 2024 (Arbeitstitel)"
output:
  html_document:
    toc: true
    code_folding: hide
  pdf_document:
    toc: true
editor_options:
  markdown:
    wrap: 72
---

```{r echo=FALSE, message=FALSE}
library(ggridges)
library(ggplot2)
library(viridis)
library(hrbrthemes)
library(dplyr)
library(DT)

# Lokal wird/wurde zur Datenminimierung einmalig clean.R auf unseren Ausgangsdaten ausgeführt.

# KANDIDATENLISTE:
data <- read.csv('daten/kandidat_innen-2024-09-06.csv')
colnames(data) <- c('Beruf', 'Geburtsjahr', 'Stadtteil', 'Liste')
data$Stadtteil <- as.factor(data$Stadtteil)
data$Partei <- as.factor(data$Liste)
data <- data %>% mutate(Alter = 2024 - Geburtsjahr)

# ALTER ULM:
demografieUlmGenderBi <- read.csv('daten/demografie_ulm-2022-12-31.csv')
demografieUlmGenderBi$Geschlecht <- as.factor(demografieUlmGenderBi$Geschlecht)
# Gender rausnehmen:
demografieUlmAnzAltersgruppen <- length(unique(demografieUlmGenderBi$Altersgruppe))
demografieUlmMtx <- matrix(nrow = demografieUlmAnzAltersgruppen, ncol = 2)
demografieUlmMtx[,1] <- sort(unique(demografieUlmGenderBi$Altersgruppe))
for (pos in seq(demografieUlmAnzAltersgruppen)) {
  demografieUlmMtx[pos,2] <- sum(demografieUlmGenderBi$Personen[demografieUlmGenderBi$Altersgruppe == demografieUlmMtx[pos,1]])
}
demografieUlm <- data.frame(demografieUlmMtx)
names(demografieUlm) <- names(demografieUlmGenderBi)[2:3]
# Altersgruppen in Schritten von zehn Jahren:
demografieUlm <- demografieUlm %>% mutate(AltersgruppeZehner = cut(Altersgruppe, breaks = seq(from = 0, to = 80, by = 10), right = FALSE))
levels(demografieUlm$AltersgruppeZehner)[levels(demografieUlm$AltersgruppeZehner) == "[70,80)"]  <- "[70,...)" 
demografieUlmZehner <- demografieUlm %>% select(any_of(c("AltersgruppeZehner", "Personen"))) %>%
  group_by(AltersgruppeZehner) %>% 
  summarise(across(everything(), sum))

rm(pos,demografieUlmMtx)

```

## Einleitung

Diesdas.

## Überblick und Highlights

Total wild.

## Bericht

### Kandidat:innen zur Ulmer Gemeinderatswahl am 9.6.2024

Insgesamt kandidieren `r nrow(data)` Kandidat_innen auf `r length(levels(data$Partei))` Listen für den Ulmer Gemeinderat.

```{r}

data %>%
  group_by(Liste) %>%
  summarise(
    Kandidat_innen = n(),
    AlterMean = round(mean(Alter),1),
    AlterSD = round(sd(Alter)),
    AlterMedian = median(Alter),
    AlterMax = max(Alter),
    AlterMin = min(Alter)
    ) %>%
  datatable(style = 'bootstrap')

```

#### Altersverteilung

Altersverteilung als Dichtefunktion. Grauer Strich jeweils Median.

```{r fig.width=7, fig.height=8}

listenLabels <- data %>% group_by(Liste) %>%
    summarise(n = n()) %>%
    mutate(text = paste0(Liste, ' (n=', n, ')'))

plotAgeListen <- ggplot(data, aes(x = Alter, y = Liste, fill = after_stat(x))) +
  geom_density_ridges_gradient(
    scale = 2, 
    rel_min_height = 0.01, 
    bandwidth = 3,
    quantile_lines = TRUE,
    vline_color = c("lightgray"),
    quantile_fun = median
    ) +
  scale_fill_viridis() +
  scale_y_discrete(limits=rev, labels=rev(listenLabels$text)) +
  scale_x_continuous(limits=c(15,85), breaks=seq(5, 85, by=5)) +
  labs(title = 'Altersverteilung Listen') +
  theme_ipsum() +
    theme(
      legend.position="none",
      panel.spacing = unit(0.1, "lines"),
      strip.text.x = element_text(size = 8)
    )
plotAgeListen

demografieUlmZehnerNumeric <- as.matrix(demografieUlmZehner)
demografieUlmZehnerNumeric[,1] <-  seq(from = 0, to = 70, by = 10)
plotAgeUlm <- ggplot(demografieUlmZehnerNumeric, aes(x = AltersgruppeZehner, y = Personen)) + 
  geom_point() +
  geom_smooth() #+
  #ylim(0,NA)

plotAgeUlm
```

#### Top Berufe

```{r}

berufe <- data %>%
            mutate(Beruf = replace(Beruf, Beruf == "Student" | Beruf == 'Studentin', "Student_in")) %>%
            mutate(Beruf = replace(Beruf, Beruf == "Schüler" | Beruf == 'Schülerin', "Schüler_in")) %>%
            mutate(Beruf = replace(Beruf, Beruf == "Auszubildender" | Beruf == 'Auszubildende', "Auszubildende_r")) %>%
            mutate(Beruf = replace(Beruf, Beruf == "Arzt" | Beruf == 'Ärztin', "Ärzt_in")) %>%
            mutate(Beruf = replace(Beruf, Beruf == "Architekt" | Beruf == 'Architektin', "Architekt_in")) %>%
            mutate(Beruf = replace(Beruf, Beruf == "Fraktionsgeschäftsführer" | Beruf == 'Fraktionsgeschäftsführerin', "Fraktionsgeschäftsführer_in")) %>%
            mutate(Beruf = replace(Beruf, Beruf == "Lehrer" | Beruf == 'Lehrerin', "Lehrer_in")) %>%
            group_by(Beruf) %>%
            mutate(Beruf = replace(Beruf, Beruf == "Psychologe" | Beruf == 'Psychologin', "Psycholog_in")) %>%
            group_by(Beruf) %>%
            summarise(n = n()) %>%
            arrange(desc(n))

berufe %>%
  datatable(style = 'bootstrap', filter = 'top')
```

## Vorgehensweise und Begriffe

Statistiksoftware R, inbes. R Markdown, GitHub Actions, ...

Daten und nachvollziehbare Aufbereitung auf GitHub:
<https://github.com/semaphor/politische-demografie-ulm>

-   [Demografie](https://www.bpb.de/kurz-knapp/lexika/das-junge-politik-lexikon/320066/demografie)

## Quellen und Autor_innen

Quellen:

-   Öffentliche Bekanntmachung der Wahlvorschläge zur Wahl des
    Gemeinderats und der Ortschaftsräte am 09. Juni 2024, Stadt Ulm,
    04.04.2024,
    [Link](https://www.ulm.de/-/media/ulm/zdv/downloads/oeffentliche-bekanntmachungen/2024/april-2024/20240404zugelassene-wahlvorschlge-zur-wahl-des-gemeinderats-und-der-ortschaftsrte-am-09-juni-2024sig.pdf)

-   Tabelle 12411-0018 "Bevölkerung: Kreise, Stichtag, Geschlecht,
    Altersgruppen" für 08421 "Ulm, kreisfreie Stadt", per 31.12.2022,
    Statistisches Bundesamt,
    [Link](https://www-genesis.destatis.de/genesis//online?operation=table&code=12411-0018&bypass=true&levelindex=0&levelid=1716154099952#abreadcrumb)

-   Zusammensetzung Ulmer Gemeinderat Wahlperiode 2019-2024:

    -   Webseiten der Stadt Ulm,
        [Link](https://www.ulm.de/rathaus/stadtpolitik/gemeinderat)

    -   Alter: Internetrecherche, diverse Quellen (auf Nachfrage bei den
        Autor\*innen)

Von: Jakob Pietron, Simon Lüke
